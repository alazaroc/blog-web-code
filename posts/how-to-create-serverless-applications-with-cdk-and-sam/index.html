<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="How to create serverless applications with CDK and SAM" /><meta property="og:locale" content="en" /><meta name="description" content="CDK and SAM can be used together to create serverless applications. You will use CDK to define and create your AWS resources, and you will use SAM to test Lambda, API Gateway and DynamodDB resources." /><meta property="og:description" content="CDK and SAM can be used together to create serverless applications. You will use CDK to define and create your AWS resources, and you will use SAM to test Lambda, API Gateway and DynamodDB resources." /><link rel="canonical" href="https://www.playingaws.com//posts/how-to-create-serverless-applications-with-cdk-and-sam/" /><meta property="og:url" content="https://www.playingaws.com//posts/how-to-create-serverless-applications-with-cdk-and-sam/" /><meta property="og:site_name" content="Playing AWS" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-04-25T20:45:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="How to create serverless applications with CDK and SAM" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-02-16T00:51:19+01:00","datePublished":"2022-04-25T20:45:00+02:00","description":"CDK and SAM can be used together to create serverless applications. You will use CDK to define and create your AWS resources, and you will use SAM to test Lambda, API Gateway and DynamodDB resources.","headline":"How to create serverless applications with CDK and SAM","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.playingaws.com//posts/how-to-create-serverless-applications-with-cdk-and-sam/"},"url":"https://www.playingaws.com//posts/how-to-create-serverless-applications-with-cdk-and-sam/"}</script><title>How to create serverless applications with CDK and SAM | Playing AWS</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Playing AWS"><meta name="application-name" content="Playing AWS"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/favicons/favicon.ico" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Playing AWS</a></div><div class="site-subtitle font-italic">Learn, remove barriers and practice</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://www.linkedin.com/in/alejandro-lazaro-chueca/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://github.com/alazaroc" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>How to create serverless applications with CDK and SAM</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"> <img src="/assets/img/header.jpeg" alt="header"><h1 data-toc-skip>How to create serverless applications with CDK and SAM</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1650912300" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Apr 25, 2022 </em> </span> <span> Updated <em class="" data-ts="1676505079" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Feb 16, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://www.linkedin.com/in/alejandro-lazaro-chueca/">Alejandro Lazaro</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2246 words"> <em>12 min</em> read</span></div></div></div><div class="post-content"><hr /><h2 id="tldr"><span class="mr-2">TLDR</span><a href="#tldr" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><blockquote><p>A <strong>serverless application</strong> is more than just a Lambda Function. It is a combination of Lambda functions, event sources, APIs, databases, and other resources that work together to perform tasks.</p></blockquote><p>Creating serverless resources from the AWS Console is quick and easy, but as you know you should only use it for testing purposes when you are learning how it works. After that, and thinking about <strong>how to use the resources in a real project</strong>, you will need:</p><ul><li><strong>IaC</strong>: to create your resources in a way that allows you to recreate them easily<li><strong>Version control</strong>: to track all the code modifications<li><strong>CI/CD</strong>: to automate the release process</ul><blockquote class="prompt-info"><div><p>Does anyone use CloudFormation or Terraform to manage their serverless resources? Possibly but come on, there is a better way!</p></div></blockquote><blockquote class="prompt-tip"><div><p>To manage your serverless resources, there are much better options:</p><ul><li><code class="language-plaintext highlighter-rouge">SAM (Serverless Application Model) / Serverless Framework</code>: declarative option with templates. Specific frameworks for serverless applications<li><code class="language-plaintext highlighter-rouge">CDK / Pulumi</code>: add a level of abstraction and allow you to define the infrastructure with modern programming languages</ul></div></blockquote><p>In this article, we will review the approach to combining both <strong>CDK + SAM</strong>.</p><blockquote class="prompt-info"><div><p>By the way, CDK + SAM is my preferred approach: you get the best of the 2 options!</p></div></blockquote><h2 id="cdk-vs-sam"><span class="mr-2">CDK vs SAM</span><a href="#cdk-vs-sam" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In the following articles, you will find the basics of CDK and SAM.</p><ul><li>CDK basics: <a href="/posts/how-to-create-infrastructure-with-cdk/" target="_blank">How to create infrastructure with CDK</a><li>SAM basics: <a href="/posts/how-to-create-serverless-applications-with-sam/" target="_blank">How to create serverless applications with SAM</a></ul><h3 id="what-do-cdk-and-sam-have-in-common"><span class="mr-2">What do CDK and SAM have in common?</span><a href="#what-do-cdk-and-sam-have-in-common" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Both…</p><ul><li>Are open-source, Apache-licensed software development frameworks<li>Provide Infrastructure as Code (IaC)<li>Use AWS CloudFormation behind the scenes to deploy resources<li>Provide a CLI to build and deploy applications<li>Are well integrated with AWS build pipelines<li>Support component reuse</ul><h3 id="what-are-the-main-differences-between-cdk-and-sam"><span class="mr-2">What are the main differences between CDK and SAM?</span><a href="#what-are-the-main-differences-between-cdk-and-sam" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="table-wrapper"><table><thead><tr><th> <th>CDK<th>SAM<tbody><tr><td>To declare resources<td>Uses familiar programming languages<td>Uses JSON or YAML<tr><td>Dynamic references<td>Native language capabilities<td>Pseudo parameters and logical functions<tr><td>Testing<td>Not supported natively (you could use SAM)<td>Supported (also debug)<tr><td>IaC resources<td>All<td>Focus on serverless<tr><td>Complexity<td>Very low<td>High, verbose configuration<tr><td>Maintainability<td>Higher<td>Lower</table></div><h2 id="demo-cdk--sam"><span class="mr-2">Demo: CDK + SAM</span><a href="#demo-cdk--sam" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>From Jan 6, 2022, <a href="https://aws.amazon.com/about-aws/whats-new/2022/01/aws-serverless-application-model-sam-cli-aws-cloud-development-kit-cdk/" target="_blank">AWS announced</a> the general availability of AWS SAM CLI support for local testing of AWS CDK applications. It means that <strong>you can use SAM over your CDK project to test your resources!</strong></p><p>So… we will use a new CDK project to show the CDK + SAM.</p><p>The source code is available <a href="https://github.com/alazaroc/aws-cdk-simple-webservice" target="_blank">here</a>. This repository has several CDK projects but first, we will use the <kbd>v1-simple</kbd></p><p><a href="/assets/img/posts/2022-04-12-how-to-create-serverless-applications-with-cdk-and-sam/simple-webservice-v1.png" class="popup img-link border"><img data-src="/assets/img/posts/2022-04-12-how-to-create-serverless-applications-with-cdk-and-sam/simple-webservice-v1.png" alt="simple-webservice-v1" class="lazyload" data-proofer-ignore></a></p><h3 id="prepare-to-test"><span class="mr-2">Prepare to test</span><a href="#prepare-to-test" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>With <strong>CDK</strong>, when you run <code class="language-plaintext highlighter-rouge">cdk synth</code>, it will synthesize a stack defined in your app into a CloudFormation template in a <code class="language-plaintext highlighter-rouge">json</code> file in the <code class="language-plaintext highlighter-rouge">cdk.out</code> folder.</p><p>However, <strong>SAM</strong> uses a <code class="language-plaintext highlighter-rouge">yaml</code> template, <code class="language-plaintext highlighter-rouge">template.yaml</code> or <code class="language-plaintext highlighter-rouge">template.yml</code>, in the root folder.</p><blockquote class="prompt-danger"><div><p>Also, <kbd>to test locally</kbd>, you will need this file created or you will receive an error</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">&gt;</span><span class="w"> </span>sam <span class="nb">local </span>invoke
<span class="go">Error: Template file not found at 
/.../aws-cdk-simple-webservice/template.yml
</span></pre></table></code></div></div></div></blockquote><p>Then, we have to run <code class="language-plaintext highlighter-rouge">cdk synth</code> and store the result in <code class="language-plaintext highlighter-rouge">template.yml</code> file.</p><blockquote class="prompt-tip"><div><p>use –no-staging to disable the copy of assets which allows local debugging via the SAM CLI to reference the original source files</p></div></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">cdk synth --no-staging &gt;</span><span class="w"> </span>template.yml
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>You have to use <kbd>--no-staging </kbd> because it is required for SAM CLI to local debug the source files.</p></div></blockquote><h3 id="testing-lambda-functions"><span class="mr-2">Testing Lambda Functions</span><a href="#testing-lambda-functions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>You have now a <code class="language-plaintext highlighter-rouge">template.yml</code> file and can run the SAM command to test your lambda function.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="gp">&gt;</span><span class="w"> </span>sam <span class="nb">local </span>invoke
<span class="go">Invoking index.handler (nodejs14.x)
Skip pulling image and use local one: public.ecr.aws/sam/emulation-nodejs14.x:rapid-1.46.0-x86_64.

Mounting /Users/alazaroc/Documents/MyProjects/github/aws/cdk/aws-cdk-simple-webservice/v1-simple/functions/simplest-example as /var/task:ro,delegated inside runtime container
</span><span class="gp">START RequestId: 03d4ef7d-47b4-4ad2-a491-d0e5fc797ece Version: $</span>LATEST
<span class="go">2022-04-22T21:00:38.952Z 03d4ef7d-47b4-4ad2-a491-d0e5fc797ece INFO request: {}
END RequestId: 03d4ef7d-47b4-4ad2-a491-d0e5fc797ece
REPORT RequestId: 03d4ef7d-47b4-4ad2-a491-d0e5fc797ece Init Duration: 0.39 ms Duration: 205.98 ms Billed Duration: 206 ms Memory Size: 512 MB Max Memory Used: 512 MB
{"statusCode":200,"headers":{"Content-Type":"text/html"},"body":"You have connected with the Lambda!"}%
</span></pre></table></code></div></div><p>The Lambda returns the following body: <code class="language-plaintext highlighter-rouge">You have connected with the Lambda!</code></p><h3 id="testing-lambda-functions-with-input-data"><span class="mr-2">Testing Lambda Functions with input data</span><a href="#testing-lambda-functions-with-input-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>If your Lambda Functions need input data, you can generate it from <strong>SAM CLI</strong> with the command <code class="language-plaintext highlighter-rouge">generate-event</code></p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go">sam local generate-event [OPTIONS] COMMAND [ARGS]...
</span></pre></table></code></div></div><p>You can use this command to generate sample payloads from different event sources such as S3, API Gateway, SNS, and so on. These payloads contain the information that the event sources send to your Lambda functions.</p><p>Or you can add the input data to the option <code class="language-plaintext highlighter-rouge">-e</code> of the command <code class="language-plaintext highlighter-rouge">invoke</code></p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="gp">&gt;</span><span class="w"> </span>sam <span class="nb">local </span>invoke <span class="nt">-e</span> <span class="nb">test</span>/events/simple-event.json
<span class="go">Invoking index.handler (nodejs14.x)
Skip pulling image and use local one: public.ecr.aws/sam/emulation-nodejs14.x:rapid-1.46.0-x86_64.

Mounting /Users/alazaroc/Documents/MyProjects/github/aws/cdk/aws-cdk-simple-webservice/v1-simple/functions/simplest-example as /var/task:ro,delegated inside runtime container
} "rawPath": "/test"706Z 992499c1-83c4-408d-966b-2e13f5955cbc INFO input: {
{"statusCode":200,"headers":{"Content-Type":"text/html"},"body":"You have connected with the Lambda!"}END RequestId: 992499c1-83c4-408d-966b-2e13f5955cbc
REPORT RequestId: 992499c1-83c4-408d-966b-2e13f5955cbc Init Duration: 0.89 ms Duration: 244.32 ms Billed Duration: 245 ms Memory Size: 512 MB Max Memory Used: 512 MB
</span></pre></table></code></div></div><h3 id="testing-api-gateway"><span class="mr-2">Testing API Gateway</span><a href="#testing-api-gateway" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>You have to run <code class="language-plaintext highlighter-rouge">sam local start-api</code></p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">&gt;</span><span class="w"> </span>sam <span class="nb">local </span>start-api
<span class="gp">Mounting simplest-lambda at http://127.0.0.1:3000$</span>default <span class="o">[</span>X-AMAZON-APIGATEWAY-ANY-METHOD]
<span class="go">You can now browse to the above endpoints to invoke your functions. You do not need to restart/reload SAM CLI while working on your functions, changes will be reflected instantly/automatically. You only need to restart SAM CLI if you update your AWS SAM template
2022-04-23 00:03:58  * Running on http://127.0.0.1:3000/ (Press CTRL+C to quit)
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>You can access <code class="language-plaintext highlighter-rouge">http://127.0.0.1:3000/</code> to connect with your Lambda Function</p></div></blockquote><p><a href="/assets/img/posts/2022-04-12-how-to-create-serverless-applications-with-cdk-and-sam/testing api-gateway-from-web-v1.png" class="popup img-link border"><img data-src="/assets/img/posts/2022-04-12-how-to-create-serverless-applications-with-cdk-and-sam/testing api-gateway-from-web-v1.png" alt="testing api-gateway-from-web-v1" class="lazyload" data-proofer-ignore></a></p><p>If you review your previous console, it will be updated when you accessed your API Gateway:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="gp">&gt;</span><span class="w"> </span>sam <span class="nb">local </span>start-api
<span class="go">default [X-AMAZON-APIGATEWAY-ANY-METHOD]
You can now browse to the above endpoints to invoke your functions. You do not need to restart/reload SAM CLI while working on your functions, changes will be reflected instantly/automatically. You only need to restart SAM CLI if you update your AWS SAM template
2022-04-23 00:03:58  * Running on http://127.0.0.1:3000/ (Press CTRL+C to quit)
Invoking index.handler (nodejs14.x)
Skip pulling image and use local one: public.ecr.aws/sam/emulation-nodejs14.x:rapid-1.46.0-x86_64.

Mounting /Users/alazaroc/Documents/MyProjects/github/aws/cdk/aws-cdk-simple-webservice/v1-simple/functions/simplest-example as /var/task:ro,delegated inside runtime container
</span><span class="gp">START RequestId: 8ed4a0a8-18bc-43af-b759-ad0668784351 Version: $</span>LATEST
<span class="gp">    "User-Agent": "Mozilla/5.0 (Macintosh;</span><span class="w"> </span>Intel Mac OS X 10_15_7<span class="o">)</span> AppleWebKit/537.36 <span class="o">(</span>KHTML, like Ge    <span class="s2">"Accept"</span>: <span class="s2">"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng} "</span>isBase64Encoded<span class="s2">": falsehost"</span>01 +0000<span class="s2">",-11ba1c012bf1"</span>,
<span class="go">END RequestId: 8ed4a0a8-18bc-43af-b759-ad0668784351
REPORT RequestId: 8ed4a0a8-18bc-43af-b759-ad0668784351 Init Duration: 0.51 ms Duration: 230.55 ms Billed Duration: 231 ms Memory Size: 512 MB Max Memory Used: 512 MB
2022-04-23 00:11:05 127.0.0.1 - - [23/Apr/2022 00:11:05] "GET / HTTP/1.1" 200 -
Invoking index.handler (nodejs14.x)
Skip pulling image and use local one: public.ecr.aws/sam/emulation-nodejs14.x:rapid-1.46.0-x86_64.

Mounting /Users/alazaroc/Documents/MyProjects/github/aws/cdk/aws-cdk-simple-webservice/v1-simple/functions/simplest-example as /var/task:ro,delegated inside runtime container
</span><span class="gp">START RequestId: 5759a74a-40b5-4a7e-8362-eec719ae44a7 Version: $</span>LATEST
<span class="gp">    "User-Agent": "Mozilla/5.0 (Macintosh;</span><span class="w"> </span>Intel Mac OS X 10_15_7<span class="o">)</span> AppleWebKit/537.36 <span class="o">(</span>KHTML, like Ge<span class="o">}</span> <span class="s2">"isBase64Encoded"</span>: falseco<span class="s2">"t"</span>01 +0000<span class="s2">",-11ba1c012bf1"</span>,g+xml,image/<span class="k">*</span>,<span class="k">*</span>/<span class="k">*</span><span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8<span class="s2">",
</span><span class="go">END RequestId: 5759a74a-40b5-4a7e-8362-eec719ae44a7
REPORT RequestId: 5759a74a-40b5-4a7e-8362-eec719ae44a7 Init Duration: 0.50 ms Duration: 238.45 ms Billed Duration: 239 ms Memory Size: 512 MB Max Memory Used: 512 MB
2022-04-23 00:11:06 127.0.0.1 - - [23/Apr/2022 00:11:06] "GET /favicon.ico HTTP/1.1" 200 -
</span></pre></table></code></div></div><h2 id="bonus-testing-dynamodb"><span class="mr-2">Bonus: Testing DynamoDB</span><a href="#bonus-testing-dynamodb" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Ok, testing a mocked Lambda Function is the “hello world” example and not very useful, but what about a Lambda Function that connects to a DynamoDB table?</p><p>We will update our Lambda Function to store the data in a DynamoDB table, so we are using the <kbd>v2-dynamodb</kbd> example in the repository.</p><blockquote class="prompt-info"><div><p>This code is based on the pattern defined in the web <a href="https://cdkpatterns.com/patterns/filter/?by=Lambda" target="_blank">cdkpatterns</a> as the <a href="https://github.com/cdk-patterns/serverless/blob/main/the-simple-webservice/README.md" target="_blank">simple webservice</a></p></div></blockquote><p><a href="/assets/img/posts/2022-04-12-how-to-create-serverless-applications-with-cdk-and-sam/simple-webservice-v2.png" class="popup img-link border"><img data-src="/assets/img/posts/2022-04-12-how-to-create-serverless-applications-with-cdk-and-sam/simple-webservice-v2.png" alt="simple-webservice-v2" class="lazyload" data-proofer-ignore></a></p><h3 id="case-1-testing-cloud-dynamodb"><span class="mr-2">Case 1: Testing cloud DynamoDB</span><a href="#case-1-testing-cloud-dynamodb" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>When you try to locally test a Lambda Function that stores data in a DynamoDB table, <strong>it will automatically attempt to connect to the DynamoDB service of your AWS Account</strong>.</p><p>So, to test your Account DynamoDB tables, you have to do nothing.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="gp">&gt;</span><span class="w"> </span>sam <span class="nb">local </span>invoke <span class="nt">-e</span> <span class="nb">test</span>/events/simple-event.json
<span class="go">Invoking index.handler (nodejs14.x)
Skip pulling image and use local one: public.ecr.aws/sam/emulation-nodejs14.x:rapid-1.46.0-x86_64.

Mounting /Users/alazaroc/Documents/MyProjects/github/aws/cdk/aws-cdk-simple-webservice/v2-dynamodb/functions/dynamodb-example as /var/task:ro,delegated inside runtime container
} "rawPath": "/test"492Z 69d093d2-083c-46e7-a318-636ed94d7e47 INFO request: {
</span><span class="gp">2022-04-23T06:38:56.797Z 69d093d2-083c-46e7-a318-636ed94d7e47 ERROR Invoke Error  {"errorType":"ResourceNotFoundException","errorMessage":"Requested resource not found","code":"ResourceNotFoundException","message":"Requested resource not found","time":"2022-04-23T06:38:56.787Z","requestId":"RCJDUN8DRCPPOS3SR3034ETK8VVV4KQNSO5AEMVJF66Q9ASUAAJG","statusCode":400,"retryable":false,"retryDelay":49.42319019990148,"stack":["ResourceNotFoundException: Requested resource not found","    at Request.extractError (/var/runtime/node_modules/aws-sdk/lib/protocol/json.js:52:27)","    at Request.callListeners (/var/runtime/node_modules/aws-sdk/lib/sequential_executor.js:106:20)","    at Request.emit (/var/runtime/node_modules/aws-sdk/lib/sequential_executor.js:78:10)","    at Request.emit (/var/runtime/node_modules/aws-sdk/lib/request.js:686:14)","    at Request.transition (/var/runtime/node_modules/aws-sdk/lib/request.js:22:10)","    at AcceptorStateMachine.runTo (/var/runtime/node_modules/aws-sdk/lib/state_machine.js:14:12)","    at /var/runtime/node_modules/aws-sdk/lib/state_machine.js:26:10","    at Request.&lt;anonymous&gt;</span><span class="w"> </span><span class="o">(</span>/var/runtime/node_modules/aws-sdk/lib/request.js:38:9<span class="o">)</span><span class="s2">","</span>    at Request.&lt;anonymous&gt; <span class="o">(</span>/var/runtime/node_modules/aws-sdk/lib/request.js:688:12<span class="o">)</span><span class="s2">","</span>    at Request.callListeners <span class="o">(</span>/var/runtime/node_modules/aws-sdk/lib/sequential_executor.js:116:18<span class="o">)</span><span class="s2">"]}
</span><span class="gp">{"errorType":"ResourceNotFoundException","errorMessage":"Requested resource not found","trace":["ResourceNotFoundException: Requested resource not found","    at Request.extractError (/var/runtime/node_modules/aws-sdk/lib/protocol/json.js:52:27)","    at Request.callListeners (/var/runtime/node_modules/aws-sdk/lib/sequential_executor.js:106:20)","    at Request.emit (/var/runtime/node_modules/aws-sdk/lib/sequential_executor.js:78:10)","    at Request.emit (/var/runtime/node_modules/aws-sdk/lib/request.js:686:14)","    at Request.transition (/var/runtime/node_modules/aws-sdk/lib/request.js:22:10)","    at AcceptorStateMachine.runTo (/var/runtime/node_modules/aws-sdk/lib/state_machine.js:14:12)","    at /var/runtime/node_modules/aws-sdk/lib/state_machine.js:26:10","    at Request.&lt;anonymous&gt;</span><span class="w"> </span><span class="s2">(/var/runtime/node_modules/aws-sdk/lib/request.js:38:9)"</span>,<span class="s2">"    at Request.&lt;anonymous&gt; (/var/runtime/node_modules/aws-sdk/lib/request.js:688:12)"</span>,<span class="s2">"    at Request.callListeners (/var/runtime/node_modules/aws-sdk/lib/sequentialEND RequestId: 69d093d2-083c-46e7-a318-636ed94d7e47
</span><span class="go">REPORT RequestId: 69d093d2-083c-46e7-a318-636ed94d7e47 Init Duration: 0.98 ms Duration: 928.39 ms Billed Duration: 929 ms Memory Size: 512 MB Max Memory Used: 512 MB
_executor.js:116:18)"]}%
</span></pre></table></code></div></div><blockquote class="prompt-warning"><div><p>If you don’t deploy your CDK project before attempting to test it, you will get the following ERROR: <code class="language-plaintext highlighter-rouge">"errorType":"ResourceNotFoundException","errorMessage":"Requested resource not found"</code></p></div></blockquote><p>Of course, you can set your AWS account in your sam CLI using the <code class="language-plaintext highlighter-rouge">profile</code> command. If you do not specify it, the default value will be applied.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">&gt;</span><span class="w"> </span>sam <span class="nb">local </span>invoke <span class="nt">-e</span> <span class="nb">test</span>/events/simple-event.json profile <span class="nb">test</span>
<span class="go">Invoking index.handler (nodejs14.x)
</span><span class="c">...
</span></pre></table></code></div></div><h3 id="case-2-testing-local-dynamodb"><span class="mr-2">Case 2: Testing local DynamoDB</span><a href="#case-2-testing-local-dynamodb" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>You may want to test your Lambda function locally instead of connecting to your DynamoDB account, so do the following:</p><ul><li>Download DynamoDB docker image<li>Run the DynamoDB docker image<li>Set up DynamoDB: create tables, insert data, and test it<li>Change your Lambda Function code</ul><h4 id="download-the-dynamodb-docker-image"><span class="mr-2">Download the DynamoDB docker image</span><a href="#download-the-dynamodb-docker-image" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The first step is to download the DynamoDB Docker image.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="gp">&gt;</span><span class="w"> </span>docker pull amazon/dynamodb-local
<span class="go">Using default tag: latest
latest: Pulling from amazon/dynamodb-local
3a461b3ae562: Pull complete
14d349bd5978: Pull complete
3e361eec6409: Pull complete
Digest: sha256:07e740ad576acdcfdc48676f9a153a93a8e35436ea36942d4c14939caeca8851
Status: Downloaded newer image for amazon/dynamodb-local:latest
docker.io/amazon/dynamodb-local:latest
</span></pre></table></code></div></div><h4 id="run-the-dynamodb-docker-image-locally"><span class="mr-2">Run the DynamoDB Docker image locally</span><a href="#run-the-dynamodb-docker-image-locally" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Now we have to run the locally downloaded docker image.</p><blockquote class="prompt-info"><div><p>This terminal tab will be kept running and you will have to open another one.</p></div></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="gp">&gt;</span><span class="w"> </span>docker run <span class="nt">-p</span> 8000:8000 amazon/dynamodb-local
<span class="go">Initializing DynamoDB Local with the following configuration:
Port: 8000
InMemory: true
DbPath: null
SharedDb: false
shouldDelayTransientStatuses: false
CorsParams: *
</span></pre></table></code></div></div><blockquote class="prompt-warning"><div><p>This command will not persist data in the local DynamoDB.</p></div></blockquote><h4 id="create-a-local-dynamodb-table"><span class="mr-2">Create a local DynamoDB table</span><a href="#create-a-local-dynamodb-table" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>We are going to create a <kbd>table</kbd> with the name <code class="language-plaintext highlighter-rouge">hits</code>, with a <kbd>partitionKey</kbd> with the name <code class="language-plaintext highlighter-rouge">path</code> and the <code class="language-plaintext highlighter-rouge">String</code> type.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="gp">&gt;</span><span class="w"> </span>aws dynamodb create-table <span class="nt">--table-name</span> hits <span class="nt">--attribute-definitions</span> <span class="nv">AttributeName</span><span class="o">=</span>path,AttributeType<span class="o">=</span>S <span class="nt">--key-schema</span> <span class="nv">AttributeName</span><span class="o">=</span>path,KeyType<span class="o">=</span>HASH <span class="nt">--provisioned-throughput</span> <span class="nv">ReadCapacityUnits</span><span class="o">=</span>1,WriteCapacityUnits<span class="o">=</span>1 <span class="nt">--endpoint-url</span> http://localhost:8000
<span class="go">{
    "TableDescription": {
        "TableArn": "arn:aws:dynamodb:ddblocal:000000000000:table/hits",
        "AttributeDefinitions": [
            {
                "AttributeName": "path",
                "AttributeType": "S"
            }
        ],
        "ProvisionedThroughput": {
            "NumberOfDecreasesToday": 0,
            "WriteCapacityUnits": 1,
            "LastIncreaseDateTime": 0.0,
            "ReadCapacityUnits": 1,
            "LastDecreaseDateTime": 0.0
        },
        "TableSizeBytes": 0,
        "TableName": "hits",
        "TableStatus": "ACTIVE",
        "KeySchema": [
            {
                "KeyType": "HASH",
                "AttributeName": "path"
            }
        ],
        "ItemCount": 0,
        "CreationDateTime": 1650668228.617
    }
}
</span></pre></table></code></div></div><h4 id="add-values-to-our-local-dynamodb-table"><span class="mr-2">Add values to our local DynamoDB table</span><a href="#add-values-to-our-local-dynamodb-table" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>We will add 2 elements:</p><ul><li>path: “/test”<li>path: “/hello”</ul><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">aws dynamodb put-item --table-name hits --item '{ "path": {"S": "/test"} }' --return-consumed-capacity TOTAL --endpoint-url http://localhost:8000
aws dynamodb put-item --table-name hits --item '{ "path": {"S": "/hello"} }' --return-consumed-capacity TOTAL --endpoint-url http://localhost:8000
</span></pre></table></code></div></div><h4 id="scan-your-table-locally"><span class="mr-2">Scan your table locally</span><a href="#scan-your-table-locally" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>We check that our table has the created elements:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="gp">&gt;</span><span class="w"> </span>aws dynamodb scan <span class="nt">--table-name</span> hits <span class="nt">--endpoint-url</span> http://localhost:8000
<span class="go">{
    "Count": 2,
    "Items": [
        {
            "path": {
                "S": "/test"
            }
        },
        {
            "path": {
                "S": "/hello"
            }
        }
    ],
    "ScannedCount": 2,
    "ConsumedCapacity": null
}
</span></pre></table></code></div></div><h4 id="change-lambda-function-code"><span class="mr-2">Change Lambda Function code</span><a href="#change-lambda-function-code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>We need to update our Lambda Function code to tell DynamoDB to read from our local DynamoDB service:</p><blockquote class="prompt-info"><div><p>You have to use your specific docker endpoint</p></div></blockquote><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">if </span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">AWS_SAM_LOCAL</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// mac</span>
  <span class="nx">dynamo</span><span class="p">.</span><span class="nx">endpoint</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nc">Endpoint</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://docker.for.mac.localhost:8000/</span><span class="dl">"</span><span class="p">);</span>
  <span class="c1">// windows</span>
  <span class="c1">// dynamo.endpoint = new AWS.Endpoint("http://docker.for.windows.localhost:8000/");</span>
  <span class="c1">// linux</span>
  <span class="c1">// dynamo.endpoint = new AWS.Endpoint("http://127.0.0.1:8000");</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="test-dynamodb-locally"><span class="mr-2">Test DynamoDB locally</span><a href="#test-dynamodb-locally" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>In summary, we have:</p><ul><li>the DynamoDB service locally running<li>a table (hits)<li>2 elements<ul><li>path=/test<li>path=/hello</ul></ul><p>Now we are going to test our Lambda Function which will insert data into our local DynamoDB table.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="gp">&gt;</span><span class="w"> </span>sam <span class="nb">local </span>invoke <span class="nt">-e</span> <span class="nb">test</span>/events/simple-event.json
<span class="go">Invoking index.handler (nodejs14.x)
Skip pulling image and use local one: public.ecr.aws/sam/emulation-nodejs14.x:rapid-1.46.0-x86_64.

Mounting /Users/alazaroc/Documents/MyProjects/github/aws/cdk/aws-cdk-simple-webservice/v2-dynamodb/functions/dynamodb-example as /var/task:ro,delegated inside runtime container
} "rawPath": "/test"036Z eaf85e61-e9a2-4b49-9953-d247f9794fb8 INFO request: {
2022-04-22T23:54:20.130Z eaf85e61-e9a2-4b49-9953-d247f9794fb8 INFO inserted counter for /test
END RequestId: eaf85e61-e9a2-4b49-9953-d247f9794fb8
REPORT RequestId: eaf85e61-e9a2-4b49-9953-d247f9794fb8 Init Duration: 0.48 ms Duration: 697.40 ms Billed Duration: 698 ms Memory Size: 512 MB Max Memory Used: 512 MB
{"statusCode":200,"headers":{"Content-Type":"text/html"},"body":"You have connected with the Lambda and store the data in the DynamoDB table!"}
</span></pre></table></code></div></div><p>If we scan the table again, we can review that in “/test” element will be a new <code class="language-plaintext highlighter-rouge">hits</code> column and <code class="language-plaintext highlighter-rouge">2</code> values:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="gp">&gt;</span><span class="w"> </span>aws dynamodb scan <span class="nt">--table-name</span> hits <span class="nt">--endpoint-url</span> http://localhost:8000
<span class="go">{
    "Count": 2,
    "Items": [
        {
            "path": {
                "S": "/test"
            },
            "hits": {
                "N": "2"
            }
        },
        {
            "path": {
                "S": "/hello"
            }
        }
    ],
    "ScannedCount": 2,
    "ConsumedCapacity": null
}
</span></pre></table></code></div></div><p>If you run your function more times, the value of <code class="language-plaintext highlighter-rouge">hits</code> will be updated.</p><p>And, of course, you can also test it from <strong>API Gateway</strong>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">&gt;</span><span class="w"> </span>sam <span class="nb">local </span>start-api
<span class="gp">Mounting dynamodb-lambda at http://127.0.0.1:3000$</span>default <span class="o">[</span>X-AMAZON-APIGATEWAY-ANY-METHOD]
<span class="go">You can now browse to the above endpoints to invoke your functions. You do not need to restart/reload SAM CLI while working on your functions, changes will be reflected instantly/automatically. You only need to restart SAM CLI if you update your AWS SAM template
2022-04-25 19:53:01  * Running on http://127.0.0.1:3000/ (Press CTRL+C to quit)
</span></pre></table></code></div></div><p><a href="/assets/img/posts/2022-04-12-how-to-create-serverless-applications-with-cdk-and-sam/testing api-gateway-from-web-v2.png" class="popup img-link border"><img data-src="/assets/img/posts/2022-04-12-how-to-create-serverless-applications-with-cdk-and-sam/testing api-gateway-from-web-v2.png" alt="testing api-gateway-from-web-v2" class="lazyload" data-proofer-ignore></a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/serverless/'>Serverless</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/how-to/" class="post-tag no-text-decoration" >how-to</a> <a href="/tags/cdk/" class="post-tag no-text-decoration" >cdk</a> <a href="/tags/sam/" class="post-tag no-text-decoration" >sam</a> <a href="/tags/iac/" class="post-tag no-text-decoration" >iac</a> <a href="/tags/serverless/" class="post-tag no-text-decoration" >serverless</a> <a href="/tags/comparative/" class="post-tag no-text-decoration" >comparative</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=How%20to%20create%20serverless%20applications%20with%20CDK%20and%20SAM%20-%20Playing%20AWS&url=https%3A%2F%2Fwww.playingaws.com%2F%2Fposts%2Fhow-to-create-serverless-applications-with-cdk-and-sam%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fwww.playingaws.com%2F%2Fposts%2Fhow-to-create-serverless-applications-with-cdk-and-sam%2F&text=How%20to%20create%20serverless%20applications%20with%20CDK%20and%20SAM%20-%20Playing%20AWS" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fwww.playingaws.com%2F%2Fposts%2Fhow-to-create-serverless-applications-with-cdk-and-sam%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading"></div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/aws-open-source-tools/">Getting started with AWS open-source tools</a><li><a href="/posts/getting-started-with-aws-security/">Getting Started with AWS Security</a><li><a href="/posts/how-to-improve-your-account-security/">How to improve your account security</a></ul></div><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/challenge-data-certification-in-30-days/">Challenge: 'AWS Certified Data Analytics Specialty' in 30 days</a><li><a href="/posts/10-steps-to-prepare-any-aws-certification/">10 steps to prepare any AWS certification</a><li><a href="/posts/aws-control-tower-deep-dive/">AWS Control Tower Deep Dive</a><li><a href="/posts/the-technology-behind-this-blog/">How I decided on the technology behind the blog</a><li><a href="/posts/multi-account-approach/">Getting started with AWS Multi-account approach</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/github/">github</a> <a class="post-tag" href="/tags/how-to/">how-to</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/iac/">iac</a> <a class="post-tag" href="/tags/getting-started/">getting-started</a> <a class="post-tag" href="/tags/cdk/">cdk</a> <a class="post-tag" href="/tags/deep-dive/">deep dive</a> <a class="post-tag" href="/tags/serverless/">serverless</a> <a class="post-tag" href="/tags/certification/">certification</a> <a class="post-tag" href="/tags/open-source/">open-source</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/how-to-create-serverless-applications-with-sam/"><div class="card-body"> <em class="small" data-ts="1649509620" data-df="ll" > Apr 9, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to create serverless applications with SAM</h3><div class="text-muted small"><p> Introduction The AWS Serverless Application Model (AWS SAM) is an open-source framework that you can use to build serverless applications on AWS. A serverless application is more than just a La...</p></div></div></a></div><div class="card"> <a href="/posts/how-to-deploy-serverless-website-with-terraform/"><div class="card-body"> <em class="small" data-ts="1683312780" data-df="ll" > May 5, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to deploy a serverless website with Terraform</h3><div class="text-muted small"><p> Introduction As you already know, creating and managing infrastructure can be a complex and time-consuming process, and fortunately, tools like Terraform can simplify this process by allowing yo...</p></div></div></a></div><div class="card"> <a href="/posts/how-to-create-infrastructure-with-cdk/"><div class="card-body"> <em class="small" data-ts="1647455280" data-df="ll" > Mar 16, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to create infrastructure with CDK</h3><div class="text-muted small"><p> TLDR I will explain the basics of CDK in practice: how CDK works and how to deploy a CDK project from scratch. In addition, I will share the source code of my CDK project used to create the inf...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/how-to-add-ci-cd-to-my-sam-project/" class="btn btn-outline-primary" prompt="Older"><p>How to add CI/CD to my SAM project</p></a> <a href="/posts/getting-started-with-aws-security/" class="btn btn-outline-primary" prompt="Newer"><p>Getting Started with AWS Security</p></a></div><script type="text/javascript"> document.getElementsByClassName("post-content")[0].innerHTML += '<h2 id="comment-this-post">Comment this post</h2>'; document.getElementsByClassName("post-content")[0].innerHTML += '<p>I hope this content has been relevant to you. To help me improve it would be helpful if you could give me your honest feedback.</p>'; $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "alazaroc/blog-web", "data-repo-id": "R_kgDOHA-hqQ", "data-category": "Announcements", "data-category-id": "DIC_kwDOHA-hqc4CT2E5", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "top", "data-lang": "", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementsByClassName("post-content")[0].appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/github/">github</a> <a class="post-tag" href="/tags/how-to/">how-to</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/iac/">iac</a> <a class="post-tag" href="/tags/getting-started/">getting-started</a> <a class="post-tag" href="/tags/cdk/">cdk</a> <a class="post-tag" href="/tags/deep-dive/">deep dive</a> <a class="post-tag" href="/tags/serverless/">serverless</a> <a class="post-tag" href="/tags/certification/">certification</a> <a class="post-tag" href="/tags/open-source/">open-source</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://www.linkedin.com/in/alejandro-lazaro-chueca/">Alejandro Lazaro</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Deployed with AWS resources.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-HW1NDPDLBF"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-HW1NDPDLBF'); }); </script>
